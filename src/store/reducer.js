const initialState = {
    months: [
        {
            "index": 3,
            "name": "March",
            "weeks": [
                {
                    "index": 1,
                    "days": [
                        {
                            "date": 24,
                            "day": "Sunday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 25,
                            "day": "Monday",
                            "enabled": false,
                            "events": [
                                
                            ]
                        },
                        {
                            "date": 26,
                            "day": "Tuesday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 27,
                            "day": "Wednesday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 28,
                            "day": "Thursday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 1,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 2,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 2,
                    "days": [
                        {
                            "date": 3,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 4,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 5,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 6,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 7,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 8,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 9,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 3,
                    "days": [
                        {
                            "date": 10,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 11,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 12,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 13,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 14,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 15,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 16,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 4,
                    "days": [
                        {
                            "date": 17,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 18,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 19,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 20,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 21,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 22,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 23,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 5,
                    "days": [
                        {
                            "date": 24,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 25,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 26,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 27,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 28,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 29,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 30,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 6,
                    "days": [
                        {
                            "date": 31,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 1,
                            "day": "Monday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 2,
                            "day": "Tuesday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 3,
                            "day": "Wednesday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 4,
                            "day": "Thursday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 5,
                            "day": "Friday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 6,
                            "day": "Saturday",
                            "enabled": false,
                            "events": []
                        }
                    ]
                }
            ]
        },
        {
            "index": 4,
            "name": "April",
            "weeks": [
                {
                    "index": 1,
                    "days": [
                        {
                            "date": 31,
                            "day": "Sunday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 1,
                            "day": "Monday",
                            "enabled": true,
                            "events": [
                                {
                                    id: 155558227794462,
                                    date: 1,
                                    time: "7:30pm",
                                    colour: "danger",
                                    title: "meeting",
                                    description: "dsjdaskd;laskl;"
                                }
                            ]
                        },
                        {
                            "date": 2,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 3,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 4,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 5,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 6,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 2,
                    "days": [
                        {
                            "date": 7,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 8,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 9,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 10,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 11,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 12,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 13,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 3,
                    "days": [
                        {
                            "date": 14,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 15,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 16,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 17,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 18,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 19,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 20,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 4,
                    "days": [
                        {
                            "date": 21,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 22,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 23,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 24,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 25,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 26,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 27,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 5,
                    "days": [
                        {
                            "date": 28,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 29,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 30,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 1,
                            "day": "Wednesday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 2,
                            "day": "Thursday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 3,
                            "day": "Friday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 4,
                            "day": "Saturday",
                            "enabled": false,
                            "events": []
                        }
                    ]
                }
            ]
        },
        {
            "index": 5,
            "name": "May",
            "weeks": [
                {
                    "index": 1,
                    "days": [
                        {
                            "date": 28,
                            "day": "Sunday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 29,
                            "day": "Monday",
                            "enabled": false,
                            "events": [
                                
                            ]
                        },
                        {
                            "date": 30,
                            "day": "Tuesday",
                            "enabled": false,
                            "events": []
                        },
                        {
                            "date": 1,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 2,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 3,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 4,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 2,
                    "days": [
                        {
                            "date": 5,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 6,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 7,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 8,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 9,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 10,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 11,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 3,
                    "days": [
                        {
                            "date": 12,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 13,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 14,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 15,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 16,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 17,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 18,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 4,
                    "days": [
                        {
                            "date": 19,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 20,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 21,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 22,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 23,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 24,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 25,
                            "day": "Saturday",
                            "enabled": true,
                            "events": []
                        }
                    ]
                },
                {
                    "index": 5,
                    "days": [
                        {
                            "date": 26,
                            "day": "Sunday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 27,
                            "day": "Monday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 28,
                            "day": "Tuesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 29,
                            "day": "Wednesday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 30,
                            "day": "Thursday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 31,
                            "day": "Friday",
                            "enabled": true,
                            "events": []
                        },
                        {
                            "date": 1,
                            "day": "Saturday",
                            "enabled": false,
                            "events": []
                        }
                    ]
                }
            ]
        }
    ],
    active: "April",
    activeIndex: 4,
    showPopup: false,
    showEvent: false,
    currentDate: 0,
    currentWeek: 0,
    action: null,
    selectedPost: null
}

const reducer = (state = initialState, action) => {
    switch (action.type) {
        case "showForm":
            return { ...state, showPopup: true, currentDate: action.date, currentWeek: action.week };

        case "addEvent":
            //console.log(state.months);
            //console.log('received in add event', action.payload);
            let months = state.months.map(month => {
                if (month.index === (action.payload.activeIndex)) {
                    const weeks = month.weeks.map(week => {
                        if (week.index === action.payload.currentWeek) {
                            const days = week.days.map(day => {
                                if (day.date === action.payload.currentDate) {
                                    const obj = {
                                        id: Date.now(),
                                        time: action.payload.time,
                                        title: action.payload.title,
                                        description: action.payload.description,
                                        colour: action.payload.colour
                                    }
                                    return {
                                        ...day,
                                        events: day.events.concat({ ...obj })
                                    }
                                } else {
                                    return day
                                }
                            })
                            return {
                                ...week,
                                days
                            }
                        } else {
                            return week;
                        }
                    })
                    return {
                        active: action.payload.active,
                        index: action.payload.activeIndex,
                        weeks
                    };
                }
                else {
                    return month;
                }
            })
            const finalMonths = months;
            // //console.log(finalMonths);
            return { ...state, months: finalMonths, showPopup: false }

        case "viewPost":
            return {
                ...state,
                selectedPost: action.id,
                showEvent: true,
                currentWeek: action.week,
                currentDate: action.date
            };

        case "deletePost":
            months = state.months.filter(month => {
                return month.index === action.payload.activeIndex
            })
            const obj = { index: action.payload.activeIndex, name: action.payload.active }
            // //console.log(months, obj);
            const week = months[0].weeks.map(week => {
                if (week.index === action.payload.currentWeek) {
                    const days = week.days.map(day => {
                        if (day.date === action.payload.currentDate) {
                            const events = day.events.filter(event => event.id !== action.payload.selectedPost)
                            return { ...day, events }
                        }
                        return day;
                    })
                    return { ...week, days };
                } else {
                    return week;
                }
            })
            obj['weeks'] = week;
            months = state.months.filter(month => {
                return month.index !== action.payload.activeIndex
            })
            months = months.concat([obj]);
            return { ...state, months, showEvent: false };

        case "closeAddEvent":
            return { ...state, showPopup: false }

        case "editEvent":
            return { ...state, showEvent: false, showPopup: true, action: "edit" }

        case "editEventInfo":
            //console.log('received', action.payload);
            //console.log(state.months);
            months = state.months.filter(month => {
                return month.index === action.payload.activeIndex
            })
            const final = months[0].weeks.map(week => {
                if (week.index === action.payload.currentWeek) {
                    // //console.log('week', week);
                    const days = week.days.map(day => {
                        if (day.date === action.payload.currentDate) {
                            const events = day.events.map(event => {
                                if (event.id === action.payload.selectedPost) {
                                    return {
                                        colour: action.payload.colour,
                                        date: event.date,
                                        description: action.payload.description,
                                        id: event.id,
                                        time: action.payload.time,
                                        title: action.payload.title,
                                    }
                                } else {
                                    return event;
                                }
                            });
                            // //console.log('events', events);
                            return { ...day, events }
                        }
                        return day;
                    })

                    //    //console.log('days', days);
                    return { ...week, days };
                }
                return week;
            })
            //console.log('final', final);
            const ob = {
                index: action.payload.activeIndex,
                active: action.payload.active,
                weeks: final
            }
            months = state.months.filter(month => {
                return month.index !== action.payload.activeIndex
            })
            months = months.concat([ob]);
            //console.log(months);
            return { ...state, months, showPopup: false, action: null };

        case "hideEventInfo":
            return { ...state, showEvent: false }

        case "previousMonth":
            const prevIndex = action.index > 3 ? action.index - 1 : action.index;
            const prevMonth = state.months.filter(month => month.index === prevIndex);
            //console.log('index changed to', prevIndex);
            //console.log('months now', prevMonth);
            return { ...state, activeIndex: prevIndex, active: prevMonth[0]['name'] };

        case "nextMonth":
            const index = action.index < 5 ? action.index + 1 : action.index;
            const monthsa = state.months.filter(month => month.index === index);
            //console.log('index changed to', index);
            //console.log('months now', monthsa);
            return { ...state, activeIndex: index, active: monthsa[0]['name'] };

        default:
            return state;
    }

}

export default reducer;